<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Task Orchestrator: include/command.h File Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="style.css" rel="stylesheet" type="text/css"/>
<link href="dark_style.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Task Orchestrator
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">command.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="request_8h_source.html">request.h</a>&quot;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for command.h:</div>
<div class="dyncontent">
<div class="center"><img src="command_8h__incl.png" border="0" usemap="#ainclude_2command_8h" alt=""/></div>
<map name="ainclude_2command_8h" id="ainclude_2command_8h">
<area shape="rect" title=" " alt="" coords="28,5,163,32"/>
<area shape="rect" href="request_8h.html" title=" " alt="" coords="5,80,81,107"/>
<area shape="rect" title=" " alt="" coords="106,80,189,107"/>
<area shape="rect" title=" " alt="" coords="6,155,81,181"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="command_8h__dep__incl.png" border="0" usemap="#ainclude_2command_8hdep" alt=""/></div>
<map name="ainclude_2command_8hdep" id="ainclude_2command_8hdep">
<area shape="rect" title=" " alt="" coords="65,5,199,32"/>
<area shape="rect" href="command_8c.html" title=" " alt="" coords="5,80,117,107"/>
<area shape="rect" href="orchestrator_8c.html" title=" " alt="" coords="141,80,264,107"/>
</map>
</div>
</div>
<p><a href="command_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a937f20aeca8cb1f294ad9b68340fb2d1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8h.html#a937f20aeca8cb1f294ad9b68340fb2d1">HISTORY_NAME</a>&#160;&#160;&#160;&quot;history&quot;</td></tr>
<tr class="memdesc:a937f20aeca8cb1f294ad9b68340fb2d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name of the history file.  <a href="command_8h.html#a937f20aeca8cb1f294ad9b68340fb2d1">More...</a><br /></td></tr>
<tr class="separator:a937f20aeca8cb1f294ad9b68340fb2d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7c52b2573cda56b38259890b03be026e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8h.html#a7c52b2573cda56b38259890b03be026e">exec</a> (<a class="el" href="request_8h.html#a1abc891df97d2318f8fb4832a28ae63c">Request</a> *r, char *output_dir, struct timeval start_time)</td></tr>
<tr class="memdesc:a7c52b2573cda56b38259890b03be026e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a command, single or piped, using process forking, it also handles the redirection of stdout and stderr to respective task files, as well as the writing of the execution time to a file, and the writing of the task number, command and execution time to the history file.  <a href="command_8h.html#a7c52b2573cda56b38259890b03be026e">More...</a><br /></td></tr>
<tr class="separator:a7c52b2573cda56b38259890b03be026e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a937f20aeca8cb1f294ad9b68340fb2d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a937f20aeca8cb1f294ad9b68340fb2d1">&#9670;&nbsp;</a></span>HISTORY_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HISTORY_NAME&#160;&#160;&#160;&quot;history&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Name of the history file. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7c52b2573cda56b38259890b03be026e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c52b2573cda56b38259890b03be026e">&#9670;&nbsp;</a></span>exec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int exec </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="request_8h.html#a1abc891df97d2318f8fb4832a28ae63c">Request</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>output_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&#160;</td>
          <td class="paramname"><em>start_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes a command, single or piped, using process forking, it also handles the redirection of stdout and stderr to respective task files, as well as the writing of the execution time to a file, and the writing of the task number, command and execution time to the history file. </p>
<p>This is the main function of the <a class="el" href="command_8c.html">command.c</a> module, used in <a class="el" href="orchestrator_8c.html">orchestrator.c</a> server to execute a command.</p>
<p>First, all the necessary files are created, namely the output directory for the task files, such as the output file, the error file and the time file. Also opens the history file to write the task number, the command and the execution time.</p>
<p>This file's names are defined in the macros <a class="el" href="command_8c.html#a2a9e71d817d8ed2fa28ce7c7174f403e">OUTPUT_NAME</a>, <a class="el" href="command_8c.html#a5c3d9acd67ec01c64586edc0046dbde6">ERROR_NAME</a>, <a class="el" href="command_8c.html#a8ebe81095ed8d1416071e2403de02de9">TIME_NAME</a> and <a class="el" href="command_8h.html#a937f20aeca8cb1f294ad9b68340fb2d1">HISTORY_NAME</a>.</p>
<p>It uses the fork system call to create a child process that will execute the command. The parent process will wait for the child process to finish. This fork call is inside another fork call so the parent process can wait for the child process to finish and send the request to the orchestrator as completed. This way, the server can continue to receive and handle new requests while the child process is executing the command.</p>
<p>The inner parent process, after waiting for the child process to finish executing the command, writes the total time since the request was received and the command finished executing to the time file and the history file.</p>
<p>It uses the <a class="el" href="command_8c.html#afcb166c07479038a015882c5cb6e9a24">parse_cmd</a> function to parse the command into an array of arguments. It also uses the <a class="el" href="command_8c.html#a1c902d6f3597bd174b4da437f58181c1">parse_cmd_pipes</a> function in case the command is piped.</p>
<p>After the command is parsed, it is executed using the execvp system call. When execvp fails (e.g returns -1) it writes an error message to stderr using the <a class="el" href="command_8c.html#ad16a1633214a99ca20cfeba39328ab44">write_error</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>The request containing the command to execute, if the command is piped and the task number </td></tr>
    <tr><td class="paramname">output_dir</td><td>The output directory to create the task directory and respective task result files </td></tr>
    <tr><td class="paramname">start_time</td><td>The time when the execute request was received to calculate the total time since the request was received and the command finished executing </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
        <hr class="footer">
        <address class="footer">
            <small>
                Generated on Tue May 7 2024 16:40:26 for <b>Task Orchestrator</b> by
                <a href="http://www.doxygen.org/index.html">
                    <img class="footer" src="doxygen.png" alt="doxygen" onerror="this.onerror=null;this.src='doxygen.svg';"/>
                </a> 1.9.1. All rights reserved.
            </small>
        </address>
	</body>
</html>
