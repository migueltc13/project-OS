<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=9"/>
		<meta name="generator" content="Doxygen 1.9.1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>Task Orchestrator: src/command.c File Reference</title>
		<link href="tabs.css" rel="stylesheet" type="text/css"/>
		<script type="text/javascript" src="jquery.js"></script>
		<script type="text/javascript" src="dynsections.js"></script>
		<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
		<link href="doxygen.css" rel="stylesheet" type="text/css" />
		<link href="style.css" rel="stylesheet" type="text/css"/>
<link href="dark_style.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
		<div id="titlearea">
			<table cellspacing="0" cellpadding="0">
				<tbody>
					<tr style="height: 56px;">
						<td id="projectalign" style="padding-left: 0.5em;">
							<div id="projectname">Task Orchestrator
							</div>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">command.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="command_8h_source.html">command.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="orchestrator_8h_source.html">orchestrator.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__nr_8h_source.html">task_nr.h</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;sys/wait.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for command.c:</div>
<div class="dyncontent">
<div class="center"><img src="command_8c__incl.png" border="0" usemap="#asrc_2command_8c" alt=""/></div>
<map name="asrc_2command_8c" id="asrc_2command_8c">
<area shape="rect" title=" " alt="" coords="539,5,651,32"/>
<area shape="rect" href="command_8h.html" title=" " alt="" coords="50,80,141,107"/>
<area shape="rect" href="orchestrator_8h.html" title=" " alt="" coords="165,80,266,107"/>
<area shape="rect" href="task__nr_8h.html" title=" " alt="" coords="290,80,365,107"/>
<area shape="rect" title=" " alt="" coords="389,80,450,107"/>
<area shape="rect" title=" " alt="" coords="474,80,538,107"/>
<area shape="rect" title=" " alt="" coords="563,80,628,107"/>
<area shape="rect" title=" " alt="" coords="652,80,720,107"/>
<area shape="rect" title=" " alt="" coords="745,80,803,107"/>
<area shape="rect" title=" " alt="" coords="828,80,891,107"/>
<area shape="rect" title=" " alt="" coords="915,80,995,107"/>
<area shape="rect" title=" " alt="" coords="1019,80,1102,107"/>
<area shape="rect" href="request_8h.html" title=" " alt="" coords="5,155,81,181"/>
<area shape="rect" title=" " alt="" coords="106,155,189,181"/>
<area shape="rect" title=" " alt="" coords="6,229,81,256"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a29b7451465deac204c5f7cb1f9c6e1fc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a29b7451465deac204c5f7cb1f9c6e1fc">MAX_ARGS</a>&#160;&#160;&#160;<a class="el" href="request_8h.html#a11b2387a44dc0cf3642ddcbe0581276b">MAX_CMD_SIZE</a></td></tr>
<tr class="memdesc:a29b7451465deac204c5f7cb1f9c6e1fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">The max number of arguments in a command.  <a href="command_8c.html#a29b7451465deac204c5f7cb1f9c6e1fc">More...</a><br /></td></tr>
<tr class="separator:a29b7451465deac204c5f7cb1f9c6e1fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaefa74c04b5ae5540704aaa5917184f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#adaefa74c04b5ae5540704aaa5917184f">ERROR_MSG_SIZE</a>&#160;&#160;&#160;<a class="el" href="request_8h.html#a11b2387a44dc0cf3642ddcbe0581276b">MAX_CMD_SIZE</a> + 100</td></tr>
<tr class="memdesc:adaefa74c04b5ae5540704aaa5917184f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The max size of the error message.  <a href="command_8c.html#adaefa74c04b5ae5540704aaa5917184f">More...</a><br /></td></tr>
<tr class="separator:adaefa74c04b5ae5540704aaa5917184f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3a2c91b0e41aa91f485480817b7a02"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#aac3a2c91b0e41aa91f485480817b7a02">TASK_PREFIX_NAME</a>&#160;&#160;&#160;&quot;task&quot;</td></tr>
<tr class="memdesc:aac3a2c91b0e41aa91f485480817b7a02"><td class="mdescLeft">&#160;</td><td class="mdescRight">The prefix name for the task directories.  <a href="command_8c.html#aac3a2c91b0e41aa91f485480817b7a02">More...</a><br /></td></tr>
<tr class="separator:aac3a2c91b0e41aa91f485480817b7a02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a9e71d817d8ed2fa28ce7c7174f403e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a2a9e71d817d8ed2fa28ce7c7174f403e">OUTPUT_NAME</a>&#160;&#160;&#160;&quot;out&quot;</td></tr>
<tr class="memdesc:a2a9e71d817d8ed2fa28ce7c7174f403e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the output file.  <a href="command_8c.html#a2a9e71d817d8ed2fa28ce7c7174f403e">More...</a><br /></td></tr>
<tr class="separator:a2a9e71d817d8ed2fa28ce7c7174f403e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c3d9acd67ec01c64586edc0046dbde6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a5c3d9acd67ec01c64586edc0046dbde6">ERROR_NAME</a>&#160;&#160;&#160;&quot;err&quot;</td></tr>
<tr class="memdesc:a5c3d9acd67ec01c64586edc0046dbde6"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the error file.  <a href="command_8c.html#a5c3d9acd67ec01c64586edc0046dbde6">More...</a><br /></td></tr>
<tr class="separator:a5c3d9acd67ec01c64586edc0046dbde6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ebe81095ed8d1416071e2403de02de9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a8ebe81095ed8d1416071e2403de02de9">TIME_NAME</a>&#160;&#160;&#160;&quot;time&quot;</td></tr>
<tr class="memdesc:a8ebe81095ed8d1416071e2403de02de9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the time file.  <a href="command_8c.html#a8ebe81095ed8d1416071e2403de02de9">More...</a><br /></td></tr>
<tr class="separator:a8ebe81095ed8d1416071e2403de02de9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1c902d6f3597bd174b4da437f58181c1"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a1c902d6f3597bd174b4da437f58181c1">parse_cmd_pipes</a> (char *cmd, int *N)</td></tr>
<tr class="memdesc:a1c902d6f3597bd174b4da437f58181c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a piped command into an array of single commands.  <a href="command_8c.html#a1c902d6f3597bd174b4da437f58181c1">More...</a><br /></td></tr>
<tr class="separator:a1c902d6f3597bd174b4da437f58181c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afcb166c07479038a015882c5cb6e9a24"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#afcb166c07479038a015882c5cb6e9a24">parse_cmd</a> (char *cmd)</td></tr>
<tr class="memdesc:afcb166c07479038a015882c5cb6e9a24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a command into an array of arguments.  <a href="command_8c.html#afcb166c07479038a015882c5cb6e9a24">More...</a><br /></td></tr>
<tr class="separator:afcb166c07479038a015882c5cb6e9a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad16a1633214a99ca20cfeba39328ab44"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#ad16a1633214a99ca20cfeba39328ab44">write_error</a> (char *cmd_name)</td></tr>
<tr class="memdesc:ad16a1633214a99ca20cfeba39328ab44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write an error message to stderr.  <a href="command_8c.html#ad16a1633214a99ca20cfeba39328ab44">More...</a><br /></td></tr>
<tr class="separator:ad16a1633214a99ca20cfeba39328ab44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c52b2573cda56b38259890b03be026e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="command_8c.html#a7c52b2573cda56b38259890b03be026e">exec</a> (<a class="el" href="request_8h.html#a1abc891df97d2318f8fb4832a28ae63c">Request</a> *r, char *output_dir, struct timeval start_time)</td></tr>
<tr class="memdesc:a7c52b2573cda56b38259890b03be026e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a command, single or piped, using process forking, it also handles the redirection of stdout and stderr to respective task files, as well as the writing of the execution time to a file, and the writing of the task number, command and execution time to the history file.  <a href="command_8c.html#a7c52b2573cda56b38259890b03be026e">More...</a><br /></td></tr>
<tr class="separator:a7c52b2573cda56b38259890b03be026e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a29b7451465deac204c5f7cb1f9c6e1fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29b7451465deac204c5f7cb1f9c6e1fc">&#9670;&nbsp;</a></span>MAX_ARGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_ARGS&#160;&#160;&#160;<a class="el" href="request_8h.html#a11b2387a44dc0cf3642ddcbe0581276b">MAX_CMD_SIZE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The max number of arguments in a command. </p>

</div>
</div>
<a id="adaefa74c04b5ae5540704aaa5917184f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaefa74c04b5ae5540704aaa5917184f">&#9670;&nbsp;</a></span>ERROR_MSG_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_MSG_SIZE&#160;&#160;&#160;<a class="el" href="request_8h.html#a11b2387a44dc0cf3642ddcbe0581276b">MAX_CMD_SIZE</a> + 100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The max size of the error message. </p>

</div>
</div>
<a id="aac3a2c91b0e41aa91f485480817b7a02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac3a2c91b0e41aa91f485480817b7a02">&#9670;&nbsp;</a></span>TASK_PREFIX_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TASK_PREFIX_NAME&#160;&#160;&#160;&quot;task&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The prefix name for the task directories. </p>

</div>
</div>
<a id="a2a9e71d817d8ed2fa28ce7c7174f403e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a9e71d817d8ed2fa28ce7c7174f403e">&#9670;&nbsp;</a></span>OUTPUT_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OUTPUT_NAME&#160;&#160;&#160;&quot;out&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The name of the output file. </p>

</div>
</div>
<a id="a5c3d9acd67ec01c64586edc0046dbde6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c3d9acd67ec01c64586edc0046dbde6">&#9670;&nbsp;</a></span>ERROR_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_NAME&#160;&#160;&#160;&quot;err&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The name of the error file. </p>

</div>
</div>
<a id="a8ebe81095ed8d1416071e2403de02de9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ebe81095ed8d1416071e2403de02de9">&#9670;&nbsp;</a></span>TIME_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIME_NAME&#160;&#160;&#160;&quot;time&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The name of the time file. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1c902d6f3597bd174b4da437f58181c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c902d6f3597bd174b4da437f58181c1">&#9670;&nbsp;</a></span>parse_cmd_pipes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ** parse_cmd_pipes </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse a piped command into an array of single commands. </p>
<p>Used in the function <a class="el" href="command_8c.html#a7c52b2573cda56b38259890b03be026e">exec</a> to parse a piped command into an array of single commands.</p>
<p>It also strips leading and trailing whitespaces from each command, see the sencond and third example below.</p>
<p>It also can handle quoted strings, as demonstrated in the third example.</p>
<p>It can handle new lines as it's possible to have a command with multiple lines, see the fourth example.</p>
<p>Examples: </p><div class="fragment"><div class="line">- <span class="stringliteral">&quot;ls -l | cat&quot;</span> -&gt; [<span class="stringliteral">&quot;ls -l&quot;</span>, <span class="stringliteral">&quot;cat&quot;</span>]</div>
<div class="line"> </div>
<div class="line">- <span class="stringliteral">&quot;  ls -l |  cat  &quot;</span> -&gt; [<span class="stringliteral">&quot;ls -l&quot;</span>, <span class="stringliteral">&quot;cat&quot;</span>]</div>
<div class="line"> </div>
<div class="line">- <span class="stringliteral">&quot;echo \&quot;Hello   World\&quot; |cat    &quot;</span> -&gt; [<span class="stringliteral">&quot;echo \&quot;Hello   World\&quot;&quot;</span>, <span class="stringliteral">&quot;cat&quot;</span>]</div>
<div class="line"> </div>
<div class="line">- <span class="stringliteral">&quot;echo \&quot;Hello\nWorld\&quot; | cat\n\n&quot;</span> -&gt; [<span class="stringliteral">&quot;echo \&quot;HelloWorld\&quot;&quot;</span>, <span class="stringliteral">&quot;cat&quot;</span>]</div>
</div><!-- fragment --><p>Note: Uncomment the last for loop in this function to print the resulting array of single commands.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>The piped command to parse </td></tr>
    <tr><td class="paramname">N</td><td>The number of commands in the array </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An array of strings, or NULL if an error occurred </dd></dl>

</div>
</div>
<a id="afcb166c07479038a015882c5cb6e9a24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afcb166c07479038a015882c5cb6e9a24">&#9670;&nbsp;</a></span>parse_cmd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ** parse_cmd </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cmd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse a command into an array of arguments. </p>
<p>Used in the function <a class="el" href="command_8c.html#a7c52b2573cda56b38259890b03be026e">exec</a> to parse a command into an array of arguments.</p>
<p>It also strips leading and trailing whitespaces from each argument, see the sencond and third example below.</p>
<p>It also can handle quoted strings, as demonstrated in the third example.</p>
<p>Examples: </p><div class="fragment"><div class="line">- <span class="stringliteral">&quot;ls -l -a&quot;</span> -&gt; [<span class="stringliteral">&quot;ls&quot;</span>, <span class="stringliteral">&quot;-l&quot;</span>, <span class="stringliteral">&quot;-a&quot;</span>, NULL]</div>
<div class="line"> </div>
<div class="line">- <span class="stringliteral">&quot;  ls -l    -a&quot;</span> -&gt; [<span class="stringliteral">&quot;ls&quot;</span>, <span class="stringliteral">&quot;-l&quot;</span>, <span class="stringliteral">&quot;-a&quot;</span>, NULL]</div>
<div class="line"> </div>
<div class="line">- <span class="stringliteral">&quot;echo \&quot;Hello   World\&quot;&quot;</span> -&gt; [<span class="stringliteral">&quot;echo&quot;</span>, <span class="stringliteral">&quot;Hello   World&quot;</span>, NULL]</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>The command to parse </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An array of arguments, or NULL if an error occurred </dd></dl>

</div>
</div>
<a id="ad16a1633214a99ca20cfeba39328ab44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad16a1633214a99ca20cfeba39328ab44">&#9670;&nbsp;</a></span>write_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void write_error </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cmd_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write an error message to stderr. </p>
<p>Used in the function <a class="el" href="command_8c.html#a7c52b2573cda56b38259890b03be026e">exec</a> to write an error message to stderr when a command fails.</p>
<p>It's meant to be used after execvp fails, and the redirection of stderr to an error log file, via the dup2 function.</p>
<p>It checks the errno to determine the type of error, being:</p><ul>
<li>ENOENT: command not found</li>
<li>EACCES: permission denied</li>
<li>EINVAL: invalid argument(s)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd_name</td><td>The name of the command that failed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7c52b2573cda56b38259890b03be026e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c52b2573cda56b38259890b03be026e">&#9670;&nbsp;</a></span>exec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int exec </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="request_8h.html#a1abc891df97d2318f8fb4832a28ae63c">Request</a> *&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>output_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&#160;</td>
          <td class="paramname"><em>start_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes a command, single or piped, using process forking, it also handles the redirection of stdout and stderr to respective task files, as well as the writing of the execution time to a file, and the writing of the task number, command and execution time to the history file. </p>
<p>This is the main function of the <a class="el" href="command_8c.html">command.c</a> module, used in <a class="el" href="orchestrator_8c.html">orchestrator.c</a> server to execute a command.</p>
<p>First, all the necessary files are created, namely the output directory for the task files, such as the output file, the error file and the time file. Also opens the history file to write the task number, the command and the execution time.</p>
<p>This file's names are defined in the macros <a class="el" href="command_8c.html#a2a9e71d817d8ed2fa28ce7c7174f403e">OUTPUT_NAME</a>, <a class="el" href="command_8c.html#a5c3d9acd67ec01c64586edc0046dbde6">ERROR_NAME</a>, <a class="el" href="command_8c.html#a8ebe81095ed8d1416071e2403de02de9">TIME_NAME</a> and <a class="el" href="command_8h.html#a937f20aeca8cb1f294ad9b68340fb2d1">HISTORY_NAME</a>.</p>
<p>It uses the fork system call to create a child process that will execute the command. The parent process will wait for the child process to finish. This fork call is inside another fork call so the parent process can wait for the child process to finish and send the request to the orchestrator as completed. This way, the server can continue to receive and handle new requests while the child process is executing the command.</p>
<p>The inner parent process, after waiting for the child process to finish executing the command, writes the total time since the request was received and the command finished executing to the time file and the history file.</p>
<p>It uses the <a class="el" href="command_8c.html#afcb166c07479038a015882c5cb6e9a24">parse_cmd</a> function to parse the command into an array of arguments. It also uses the <a class="el" href="command_8c.html#a1c902d6f3597bd174b4da437f58181c1">parse_cmd_pipes</a> function in case the command is piped.</p>
<p>After the command is parsed, it is executed using the execvp system call. When execvp fails (e.g returns -1) it writes an error message to stderr using the <a class="el" href="command_8c.html#ad16a1633214a99ca20cfeba39328ab44">write_error</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>The request containing the command to execute, if the command is piped and the task number </td></tr>
    <tr><td class="paramname">output_dir</td><td>The output directory to create the task directory and respective task result files </td></tr>
    <tr><td class="paramname">start_time</td><td>The time when the execute request was received to calculate the total time since the request was received and the command finished executing </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if successful </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
        <hr class="footer">
        <address class="footer">
            <small>
                Generated on Tue May 7 2024 16:40:26 for <b>Task Orchestrator</b> by
                <a href="http://www.doxygen.org/index.html">
                    <img class="footer" src="doxygen.png" alt="doxygen" onerror="this.onerror=null;this.src='doxygen.svg';"/>
                </a> 1.9.1. All rights reserved.
            </small>
        </address>
	</body>
</html>
